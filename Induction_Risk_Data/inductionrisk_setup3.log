----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  H:\Other\Paper Codes for Uploading\education-migration-IV\Induction_Risk_Data\inductionrisk_setup3.log
  log type:  text
 opened on:  18 Feb 2020, 09:39:01

. 
. ************** create national and state-level induction risk *******************
. 
. *** main variables created: Using average annual inductions 19-22 over own cohort size
. * risk - national induction risk 
. * staterisk - state-level induction risk
. * nationalrisk - total national induction risk from state-level data
. * nationalrisk_ - total national induction risk from state-level data, excluding own state
. *
. * Versions of above using biannual variation
. * staterisk6m
. * nationalrisk6m
. * nationalrisk6m_
. *
. * Using biannual variation but alternate averaging method of total inductions over total cohort size
. * staterisk6mt
. * nationalrisk6mt
. * nationalrisk6mt_
. * 
. * Constructing risk as average of four years of inductions over cohort 17 size 
. * staterisk6ma
. * nationalrisk6ma
. * nationalrisk6ma_
. *
. * Notes: We have induction totals from 1955 to 1972, annual up to 1966, every six months for '67 on.
. * We have state level enrollments at age 17 for 1961 on.
. * Therefore we can compute national risk for 1955-71 and state level risk for 1961-1972.
. * Year of state enrollments has been adjusted to match year of inductions, so enrollments in 1961 were
. * the number of 17 year olds in a state two years prior. Inductions in 1971 were actual numbers inducted in 1971.
. *
. ***
. 
. 
. clear

. set mem 100m
set memory ignored.
    Memory no longer needs to be set in modern Statas; memory adjustments are performed on the fly automatically.

. set more off

. 
. ****************************************
. *** generate national induction risk ***
. ****************************************
. 
. use national_inductions, clear

. sort birthyear

. 
. *summ
. 
. **** create national-level risk ***
. gen avg_ind_nat= (ind_nat + ind_nat[_n+1] + ind_nat[_n+2]  + ind_nat[_n+3])/ 4
(3 missing values generated)

. gen risk=avg_ind_nat/cohort_size
(3 missing values generated)

. replace risk=0 if birthyear>=1955 & birthyear<=1959
(3 real changes made)

. replace avg_ind_nat=0 if birthyear>=1955 & birthyear<=1959
(3 real changes made)

. 
. summ

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   birthyear |         25        1947    7.359801       1935       1959
     ind_nat |         25    126720.1    105340.6          0     382010
 cohort_size |         25     3121680      771635    2086000    4272000
 avg_ind_nat |         25    114688.3    94732.21          0   297566.3
        risk |         25    .0423536     .033748          0    .103802

. 
. sort birthyear

. save temp, replace
(note: file temp.dta not found)
file temp.dta saved

. 
. 
. *******************************************
. *** generate state-level induction risk ***
. *******************************************
. 
. clear

. use state_inductions

. 
. *summ
. 
. **** reshape annual inductions and enrollment data ***
. gen int id=_n

. gen byte ind1973=0

. gen byte ind1974=0

. gen byte ind1975=0

. reshape long ind enr, i(id state abbrev) j(birthyear)
(note: j = 1955 1956 1957 1958 1959 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 1970 1971 1972 1973 1974 1975)
(note: enr1955 not found)
(note: enr1956 not found)
(note: enr1957 not found)
(note: enr1958 not found)
(note: enr1959 not found)
(note: enr1960 not found)
(note: enr1973 not found)
(note: enr1974 not found)
(note: enr1975 not found)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                       50   ->    1050
Number of variables                  37   ->       7
j variable (21 values)                    ->   birthyear
xij variables:
            ind1955 ind1956 ... ind1975   ->   ind
            enr1955 enr1956 ... enr1975   ->   enr
-----------------------------------------------------------------------------

. 
. *summ
. 
. replace birthyear=birthyear-19
(1,050 real changes made)

. drop id

. 
. **** generate national-level inductions and enrollment from the state data ***
. bys birthyear: egen ind_tot=total(ind)

. bys birthyear: egen enr_tot=total(enr)

. 
. gen ind_tot_=ind_tot-ind

. gen enr_tot_=enr_tot-enr
(450 missing values generated)

. 
. **** create national-level risk from the state data ***
. sort statefip birthyear

. by statefip: gen avg_ind= (ind + ind[_n+1] + ind[_n+2]  + ind[_n+3])/ 4 
(150 missing values generated)

. gen avg_tot_ind= (ind_tot + ind_tot[_n+1] + ind_tot[_n+2]  + ind_tot[_n+3])/ 4 
(3 missing values generated)

. gen avg_tot_ind_= (ind_tot_ + ind_tot_[_n+1] + ind_tot_[_n+2]  + ind_tot_[_n+3])/ 4 
(3 missing values generated)

. drop if avg_ind==.
(150 observations deleted)

. 
. **** create state-level risk ***
. gen staterisk=avg_ind/enr
(300 missing values generated)

. gen nationalrisk=avg_tot_ind/enr_tot
(300 missing values generated)

. gen nationalrisk_=avg_tot_ind_/enr_tot_
(300 missing values generated)

. 
. ******** restrict to 1942-53 **********
. * NOTE dropping gets rid of any later birthyears that have wrong totals due to non-restriction of forward sums above
. drop if birthyear<1942 | birthyear>1953
(300 observations deleted)

. 
. *** merge national-level data ***
. sort birthyear

. merge birthyear using temp
(note: you are using old merge syntax; see [D] merge for new syntax)
variable birthyear does not uniquely identify observations in the master data

. drop _merge

. 
. fillin state birthyear

. drop _fillin

. sort birthyear

. merge birthyear using temp, update
(note: you are using old merge syntax; see [D] merge for new syntax)
variable birthyear does not uniquely identify observations in the master data

. drop _merge

. drop if state==""
(25 observations deleted)

. erase temp.dta

. sort statefip birthyear

. save inductions, replace
file inductions.dta saved

. 
. *table birthyear, c(mean risk mean nationalrisk mean nationalrisk_ mean staterisk)
. 
. *summ
. 
. **** generate short inductions data
. rename statefip bplg

. keep birthyear bplg staterisk nationalrisk nationalrisk_ risk

. drop if bplg==.
(650 observations deleted)

. sort bplg birthyear

. save inductions_short, replace
file inductions_short.dta saved

. 
. summ

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   birthyear |        600      1947.5    3.454933       1942       1953
        bplg |        600       29.32    15.63666          1         56
   staterisk |        600    .0568927    .0358751   .0017217   .1532445
nationalrisk |        600    .0602736    .0352513   .0038946   .1120752
nationalri~_ |        600    .0602727     .035252   .0038362   .1132613
-------------+---------------------------------------------------------
        risk |        600    .0550601    .0315883   .0033378    .103802

. 
. 
. *************************************************************************
. *** generate state-level induction risk using 6 month level variation ***
. *************************************************************************
. 
. clear

. use state_inductions_aw

. 
. summ

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       state |          0
    statefip |         50       29.32    15.78224          1         56
      abbrev |          0
     ind1955 |         50     4126.62    4420.086        123      22654
     ind1956 |         50      2685.6    2924.882         70      14728
-------------+---------------------------------------------------------
     ind1957 |         50     3464.24     3833.01        166      19594
     ind1958 |         50      2400.7     2572.02        107      12059
     ind1959 |         50      2162.5    2325.857        122       9933
     ind1960 |         50      1730.7    2031.127         72       8662
     ind1961 |         50     1162.62    1345.031         61       6276
-------------+---------------------------------------------------------
     ind1962 |         50     3009.54    3404.168        151      16600
     ind1963 |         50     1401.06    1497.191         72       7026
     ind1964 |         50     2880.24    3369.751        210      15449
     ind1965 |         50     1987.82    2351.317        106      10237
     ind1966 |         50     6694.44    7610.757        251      31777
-------------+---------------------------------------------------------
    ind19671 |         50     3257.54    3802.901        120      16320
    ind19672 |         50     2648.56    2945.524        108      14834
    ind19681 |         50      4022.1    4429.071        108      21035
    ind19682 |         50     1774.84    1782.513        110       7835
    ind19691 |         50     3400.34    3276.778        121      13830
-------------+---------------------------------------------------------
    ind19692 |         50      2196.8    2149.709        108       9345
    ind19701 |         50     1828.92    1776.139         73       7083
    ind19702 |         50     1387.56    1395.389         75       6204
    ind19711 |         50     1643.04    1714.856         79       7801
    ind19712 |         50      206.92    263.8443         13       1451
-------------+---------------------------------------------------------
    ind19721 |         50      285.62    325.0029         17       1701
    ind19722 |         50      686.76    726.5609         36       3398
     enr1961 |         50     56192.1    59423.28       1746     278511
     enr1962 |         50    59035.88    62200.68       2432     287500
     enr1963 |         50    39739.34    39320.84       1965     181446
-------------+---------------------------------------------------------
     enr1964 |         50     45409.4    46896.26       2071     223000
     enr1965 |         50    52809.52    52590.41       2551     239600
     enr1966 |         50    53523.48    53774.54       2802     261500
     enr1967 |         50    54697.92    55620.11       3022     273000
     enr1968 |         50    54985.72     56037.1       3073     276712
-------------+---------------------------------------------------------
     enr1969 |         50    57456.48    58764.68       3379     287854
     enr1970 |         50    59585.66    60716.26       3800     300218
     enr1971 |         50    60817.72       62193       4137     308300
     enr1972 |         50     62418.1    64291.82       4395     319994

. 
. **** reshape annual inductions and enrollment data into 6 month level data for each state and year combo ***
. gen int id=_n

. 
. forvalues x = 55/66 {
  2.   gen ind19`x'1 = ind19`x'/2
  3.   gen ind19`x'2 = ind19`x'/2
  4.   drop ind19`x'
  5.   }

.   
. forvalues x = 61/72 {
  2.   gen enr19`x'1 = enr19`x'/2
  3.   gen enr19`x'2 = enr19`x'/2
  4.   drop enr19`x'
  5.   }  

.   
. gen byte ind19731=0

. gen byte ind19741=0

. gen byte ind19751=0

. gen byte ind19761=0

. gen byte ind19732=0

. gen byte ind19742=0

. gen byte ind19752=0

. 
. *summ
. 
. reshape long ind enr, i(id state abbrev) j(birthyear)
(note: j = 19551 19552 19561 19562 19571 19572 19581 19582 19591 19592 19601 19602 19611 19612 19621 19622 19631 19632 19641 19642 19651 19652 19661 19662 19671 19672 19681 19682
>  19691 19692 19701 19702 19711 19712 19721 19722 19731 19732 19741 19742 19751 19752 19761)
(note: enr19551 not found)
(note: enr19552 not found)
(note: enr19561 not found)
(note: enr19562 not found)
(note: enr19571 not found)
(note: enr19572 not found)
(note: enr19581 not found)
(note: enr19582 not found)
(note: enr19591 not found)
(note: enr19592 not found)
(note: enr19601 not found)
(note: enr19602 not found)
(note: enr19731 not found)
(note: enr19732 not found)
(note: enr19741 not found)
(note: enr19742 not found)
(note: enr19751 not found)
(note: enr19752 not found)
(note: enr19761 not found)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                       50   ->    2150
Number of variables                  71   ->       7
j variable (43 values)                    ->   birthyear
xij variables:
         ind19551 ind19552 ... ind19761   ->   ind
         enr19551 enr19552 ... enr19761   ->   enr
-----------------------------------------------------------------------------

. *summ
. 
. gen birthyear6m = birthyear

. gen birth6m = birthyear

. replace birthyear = int(birthyear/10)
(2,150 real changes made)

. summ birthyear

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   birthyear |      2,150    1965.256    6.211313       1955       1976

. replace birth6m = birth6m - (birthyear*10)
(2,150 real changes made)

. summ birthyear6m birthyear birth6m

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 birthyear6m |      2,150    19654.05    62.09502      19551      19761
   birthyear |      2,150    1965.256    6.211313       1955       1976
     birth6m |      2,150    1.488372    .4999811          1          2

. replace birthyear=birthyear-19
(2,150 real changes made)

. replace birthyear6m =birthyear6m-190
(2,150 real changes made)

. summ birthyear birthyear6m

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   birthyear |      2,150    1946.256    6.211313       1936       1957
 birthyear6m |      2,150    19464.05    62.09502      19361      19571

. drop id

. 
. **** generate national-level inductions and enrollment from the state data ***
. bys birthyear6m: egen ind_tot6m=total(ind)

. bys birthyear6m: egen enr_tot6m=total(enr)

. 
. gen ind_tot6m_=ind_tot6m-ind

. gen enr_tot6m_=enr_tot6m-enr
(950 missing values generated)

. 
. **** create national-level risk from the state data ***
. sort statefip birthyear6m

. by statefip: gen avg_ind6m= (ind+ind[_n+1]+ind[_n+2]+ind[_n+3]+ind[_n+4]+ind[_n+5]+ind[_n+6]+ind[_n+7])/ 8
(350 missing values generated)

. gen avg_tot_ind6m= (ind_tot6m+ind_tot6m[_n+1]+ind_tot6m[_n+2]+ind_tot6m[_n+3]+ind_tot6m[_n+4]+ind_tot6m[_n+5]+ind_tot6m[_n+6]+ind_tot6m[_n+7])/ 8
(7 missing values generated)

. gen avg_tot_ind6m_= (ind_tot6m_+ind_tot6m_[_n+1]+ind_tot6m_[_n+2]+ind_tot6m_[_n+3]+ind_tot6m_[_n+4]+ind_tot6m_[_n+5]+ind_tot6m_[_n+6]+ind_tot6m_[_n+7])/ 8
(7 missing values generated)

. drop if avg_ind6m==.
(350 observations deleted)

. 
. **** create state-level risk ***
. gen staterisk6m=avg_ind6m/enr
(600 missing values generated)

. gen nationalrisk6m=avg_tot_ind6m/enr_tot6m
(600 missing values generated)

. gen nationalrisk6m_=avg_tot_ind6m_/enr_tot6m_
(600 missing values generated)

. 
. 
. ******** restrict to 1942-53 **********
. drop if birthyear<1942 | birthyear>1953
(600 observations deleted)

. 
. 
. **** generate short inductions data
. rename statefip bplg

. keep bplg birthyear6m staterisk6m nationalrisk6m nationalrisk6m_ 

. drop if bplg==.
(0 observations deleted)

. sort bplg birthyear6m

. save inductions_short6m, replace
(note: file inductions_short6m.dta not found)
file inductions_short6m.dta saved

. 
. summ

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        bplg |      1,200       29.32    15.63014          1         56
 birthyear6m |      1,200     19476.5    34.53854      19421      19532
 staterisk6m |      1,200    .0564983    .0375826   .0011085   .1532445
nationalr~6m |      1,200    .0598363    .0371787   .0027506   .1120752
nationalri~_ |      1,200    .0598354    .0371792   .0027006   .1132613

. 
. *************************************************************************
. *** generate state-level induction risk using 6 month level variation ***
. *** put greater weight on age 19 inductions, less on later years                        ***
. *************************************************************************
. 
. clear

. use state_inductions_aw

. 
. summ

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       state |          0
    statefip |         50       29.32    15.78224          1         56
      abbrev |          0
     ind1955 |         50     4126.62    4420.086        123      22654
     ind1956 |         50      2685.6    2924.882         70      14728
-------------+---------------------------------------------------------
     ind1957 |         50     3464.24     3833.01        166      19594
     ind1958 |         50      2400.7     2572.02        107      12059
     ind1959 |         50      2162.5    2325.857        122       9933
     ind1960 |         50      1730.7    2031.127         72       8662
     ind1961 |         50     1162.62    1345.031         61       6276
-------------+---------------------------------------------------------
     ind1962 |         50     3009.54    3404.168        151      16600
     ind1963 |         50     1401.06    1497.191         72       7026
     ind1964 |         50     2880.24    3369.751        210      15449
     ind1965 |         50     1987.82    2351.317        106      10237
     ind1966 |         50     6694.44    7610.757        251      31777
-------------+---------------------------------------------------------
    ind19671 |         50     3257.54    3802.901        120      16320
    ind19672 |         50     2648.56    2945.524        108      14834
    ind19681 |         50      4022.1    4429.071        108      21035
    ind19682 |         50     1774.84    1782.513        110       7835
    ind19691 |         50     3400.34    3276.778        121      13830
-------------+---------------------------------------------------------
    ind19692 |         50      2196.8    2149.709        108       9345
    ind19701 |         50     1828.92    1776.139         73       7083
    ind19702 |         50     1387.56    1395.389         75       6204
    ind19711 |         50     1643.04    1714.856         79       7801
    ind19712 |         50      206.92    263.8443         13       1451
-------------+---------------------------------------------------------
    ind19721 |         50      285.62    325.0029         17       1701
    ind19722 |         50      686.76    726.5609         36       3398
     enr1961 |         50     56192.1    59423.28       1746     278511
     enr1962 |         50    59035.88    62200.68       2432     287500
     enr1963 |         50    39739.34    39320.84       1965     181446
-------------+---------------------------------------------------------
     enr1964 |         50     45409.4    46896.26       2071     223000
     enr1965 |         50    52809.52    52590.41       2551     239600
     enr1966 |         50    53523.48    53774.54       2802     261500
     enr1967 |         50    54697.92    55620.11       3022     273000
     enr1968 |         50    54985.72     56037.1       3073     276712
-------------+---------------------------------------------------------
     enr1969 |         50    57456.48    58764.68       3379     287854
     enr1970 |         50    59585.66    60716.26       3800     300218
     enr1971 |         50    60817.72       62193       4137     308300
     enr1972 |         50     62418.1    64291.82       4395     319994

. 
. **** reshape annual inductions and enrollment data into 6 month level data for each state and year combo ***
. gen int id=_n

. 
. forvalues x = 55/66 {
  2.   gen ind19`x'1 = ind19`x'/2
  3.   gen ind19`x'2 = ind19`x'/2
  4.   drop ind19`x'
  5.   }

.   
. forvalues x = 61/72 {
  2.   gen enr19`x'1 = enr19`x'/2
  3.   gen enr19`x'2 = enr19`x'/2
  4.   drop enr19`x'
  5.   }  

.   
. gen byte ind19731=0

. gen byte ind19741=0

. gen byte ind19751=0

. gen byte ind19761=0

. gen byte ind19732=0

. gen byte ind19742=0

. gen byte ind19752=0

. 
. *summ
. 
. reshape long ind enr, i(id state abbrev) j(birthyear)
(note: j = 19551 19552 19561 19562 19571 19572 19581 19582 19591 19592 19601 19602 19611 19612 19621 19622 19631 19632 19641 19642 19651 19652 19661 19662 19671 19672 19681 19682
>  19691 19692 19701 19702 19711 19712 19721 19722 19731 19732 19741 19742 19751 19752 19761)
(note: enr19551 not found)
(note: enr19552 not found)
(note: enr19561 not found)
(note: enr19562 not found)
(note: enr19571 not found)
(note: enr19572 not found)
(note: enr19581 not found)
(note: enr19582 not found)
(note: enr19591 not found)
(note: enr19592 not found)
(note: enr19601 not found)
(note: enr19602 not found)
(note: enr19731 not found)
(note: enr19732 not found)
(note: enr19741 not found)
(note: enr19742 not found)
(note: enr19751 not found)
(note: enr19752 not found)
(note: enr19761 not found)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                       50   ->    2150
Number of variables                  71   ->       7
j variable (43 values)                    ->   birthyear
xij variables:
         ind19551 ind19552 ... ind19761   ->   ind
         enr19551 enr19552 ... enr19761   ->   enr
-----------------------------------------------------------------------------

. *summ
. 
. gen birthyear6m = birthyear

. gen birth6m = birthyear

. replace birthyear = int(birthyear/10)
(2,150 real changes made)

. summ birthyear

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   birthyear |      2,150    1965.256    6.211313       1955       1976

. replace birth6m = birth6m - (birthyear*10)
(2,150 real changes made)

. summ birthyear6m birthyear birth6m

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 birthyear6m |      2,150    19654.05    62.09502      19551      19761
   birthyear |      2,150    1965.256    6.211313       1955       1976
     birth6m |      2,150    1.488372    .4999811          1          2

. replace birthyear=birthyear-19
(2,150 real changes made)

. replace birthyear6m =birthyear6m-190
(2,150 real changes made)

. summ birthyear birthyear6m

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   birthyear |      2,150    1946.256    6.211313       1936       1957
 birthyear6m |      2,150    19464.05    62.09502      19361      19571

. drop id

. 
. **** generate national-level inductions and enrollment from the state data ***
. bys birthyear6m: egen ind_tot6m=total(ind)

. bys birthyear6m: egen enr_tot6m=total(enr)

. 
. gen ind_tot6m_=ind_tot6m-ind

. gen enr_tot6m_=enr_tot6m-enr
(950 missing values generated)

. 
. **** create national-level risk from the state data ***
. sort statefip birthyear6m

. by statefip: gen avg_ind6m= (0.5*(ind+ind[_n+1])+0.25*(ind[_n+2]+ind[_n+3])+0.15*(ind[_n+4]+ind[_n+5])+0.10*(ind[_n+6]+ind[_n+7]))/ 8
(350 missing values generated)

. gen avg_tot_ind6m= (0.5*(ind_tot6m+ind_tot6m[_n+1])+0.25*(ind_tot6m[_n+2]+ind_tot6m[_n+3])+0.15*(ind_tot6m[_n+4]+ind_tot6m[_n+5])+0.10*(ind_tot6m[_n+6]+ind_tot6m[_n+7]))/ 8
(7 missing values generated)

. gen avg_tot_ind6m_= (0.5*(ind_tot6m_+ind_tot6m_[_n+1])+0.25*(ind_tot6m_[_n+2]+ind_tot6m_[_n+3])+0.15*(ind_tot6m_[_n+4]+ind_tot6m_[_n+5])+0.10*(ind_tot6m_[_n+6]+ind_tot6m_[_n+7]
> ))/ 8
(7 missing values generated)

. drop if avg_ind6m==.
(350 observations deleted)

. 
. **** create state-level risk ***
. gen staterisk6mwt=avg_ind6m/enr
(600 missing values generated)

. gen nationalrisk6mwt=avg_tot_ind6m/enr_tot6m
(600 missing values generated)

. gen nationalrisk6mwt_=avg_tot_ind6m_/enr_tot6m_
(600 missing values generated)

. 
. 
. ******** restrict to 1942-53 **********
. drop if birthyear<1942 | birthyear>1953
(600 observations deleted)

. 
. 
. **** generate short inductions data
. rename statefip bplg

. keep bplg birthyear6m staterisk6mwt nationalrisk6mwt nationalrisk6mwt_ 

. drop if bplg==.
(0 observations deleted)

. sort bplg birthyear6m

. save inductions_short6mwt, replace
file inductions_short6mwt.dta saved

. 
. summ

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        bplg |      1,200       29.32    15.63014          1         56
 birthyear6m |      1,200     19476.5    34.53854      19421      19532
staterisk6~t |      1,200    .0143451     .008736   .0005542   .0384919
nationalri~t |      1,200    .0152011    .0085144   .0013753   .0292068
nationalri~_ |      1,200    .0152009    .0085146   .0013503   .0295397

. 
. *******************************************************************************
. *** generate state-level induction risk using 6 month level variation       ***
. *** construct average risk as total inductions over total cohort size 19-22 ***
. *******************************************************************************
. 
. clear

. use state_inductions_aw

. 
. **** reshape annual inductions and enrollment data into 6 month level data for each state and year combo ***
. gen int id=_n

. 
. forvalues x = 55/66 {
  2.   gen ind19`x'1 = ind19`x'/2
  3.   gen ind19`x'2 = ind19`x'/2
  4.   drop ind19`x'
  5.   }

.   
. forvalues x = 61/72 {
  2.   gen enr19`x'1 = enr19`x'/2
  3.   gen enr19`x'2 = enr19`x'/2
  4.   drop enr19`x'
  5.   }  

.   
. gen byte ind19731=0

. gen byte ind19741=0

. gen byte ind19751=0

. gen byte ind19761=0

. gen byte ind19732=0

. gen byte ind19742=0

. gen byte ind19752=0

. 
. reshape long ind enr, i(id state abbrev) j(birthyear)
(note: j = 19551 19552 19561 19562 19571 19572 19581 19582 19591 19592 19601 19602 19611 19612 19621 19622 19631 19632 19641 19642 19651 19652 19661 19662 19671 19672 19681 19682
>  19691 19692 19701 19702 19711 19712 19721 19722 19731 19732 19741 19742 19751 19752 19761)
(note: enr19551 not found)
(note: enr19552 not found)
(note: enr19561 not found)
(note: enr19562 not found)
(note: enr19571 not found)
(note: enr19572 not found)
(note: enr19581 not found)
(note: enr19582 not found)
(note: enr19591 not found)
(note: enr19592 not found)
(note: enr19601 not found)
(note: enr19602 not found)
(note: enr19731 not found)
(note: enr19732 not found)
(note: enr19741 not found)
(note: enr19742 not found)
(note: enr19751 not found)
(note: enr19752 not found)
(note: enr19761 not found)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                       50   ->    2150
Number of variables                  71   ->       7
j variable (43 values)                    ->   birthyear
xij variables:
         ind19551 ind19552 ... ind19761   ->   ind
         enr19551 enr19552 ... enr19761   ->   enr
-----------------------------------------------------------------------------

. 
. gen birthyear6m = birthyear

. gen birth6m = birthyear

. replace birthyear = int(birthyear/10)
(2,150 real changes made)

. summ birthyear

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   birthyear |      2,150    1965.256    6.211313       1955       1976

. replace birth6m = birth6m - (birthyear*10)
(2,150 real changes made)

. summ birthyear6m birthyear birth6m

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 birthyear6m |      2,150    19654.05    62.09502      19551      19761
   birthyear |      2,150    1965.256    6.211313       1955       1976
     birth6m |      2,150    1.488372    .4999811          1          2

. replace birthyear=birthyear-19
(2,150 real changes made)

. replace birthyear6m =birthyear6m-190
(2,150 real changes made)

. summ birthyear birthyear6m

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   birthyear |      2,150    1946.256    6.211313       1936       1957
 birthyear6m |      2,150    19464.05    62.09502      19361      19571

. drop id

. 
. **** generate national-level inductions and enrollment from the state data ***
. bys birthyear6m: egen ind_tot6m=total(ind)

. bys birthyear6m: egen enr_tot6m=total(enr)

. 
. gen ind_tot6m_=ind_tot6m-ind

. gen enr_tot6m_=enr_tot6m-enr
(950 missing values generated)

. 
. **** create national-level risk from the state data ***
. sort statefip birthyear6m

. by statefip: gen all_ind6m = (ind+ind[_n+1]+ind[_n+2]+ind[_n+3]+ind[_n+4]+ind[_n+5]+ind[_n+6]+ind[_n+7])
(350 missing values generated)

. gen all_tot_ind6m = (ind_tot6m+ind_tot6m[_n+1]+ind_tot6m[_n+2]+ind_tot6m[_n+3]+ind_tot6m[_n+4]+ind_tot6m[_n+5]+ind_tot6m[_n+6]+ind_tot6m[_n+7])
(7 missing values generated)

. gen all_tot_ind6m_ = (ind_tot6m_+ind_tot6m_[_n+1]+ind_tot6m_[_n+2]+ind_tot6m_[_n+3]+ind_tot6m_[_n+4]+ind_tot6m_[_n+5]+ind_tot6m_[_n+6]+ind_tot6m_[_n+7])
(7 missing values generated)

. drop if all_ind6m ==.
(350 observations deleted)

. 
. by statefip: gen all_enr6m = (enr+enr[_n+1]+enr[_n+2]+enr[_n+3]+enr[_n+4]+enr[_n+5]+enr[_n+6]+enr[_n+7])
(950 missing values generated)

. gen all_tot_enr6m = (enr_tot6m+enr_tot6m[_n+1]+enr_tot6m[_n+2]+enr_tot6m[_n+3]+enr_tot6m[_n+4]+enr_tot6m[_n+5]+enr_tot6m[_n+6]+enr_tot6m[_n+7])
(7 missing values generated)

. gen all_tot_enr6m_ = (enr_tot6m_+enr_tot6m_[_n+1]+enr_tot6m_[_n+2]+enr_tot6m_[_n+3]+enr_tot6m_[_n+4]+enr_tot6m_[_n+5]+enr_tot6m_[_n+6]+enr_tot6m_[_n+7])
(950 missing values generated)

. 
. 
. **** create state-level risk ***
. gen staterisk6mt = all_ind6m/all_enr6m
(950 missing values generated)

. gen nationalrisk6mt = all_tot_ind6m/all_tot_enr6m
(257 missing values generated)

. gen nationalrisk6mt_ = all_tot_ind6m_/all_tot_enr6m_
(950 missing values generated)

. 
. 
. ******** restrict to 1942-53 **********
. drop if birthyear<1942 | birthyear>1953
(600 observations deleted)

. 
. 
. **** generate short inductions data
. rename statefip bplg

. keep bplg birthyear6m staterisk6mt nationalrisk6mt nationalrisk6mt_ 

. drop if bplg==.
(0 observations deleted)

. sort bplg birthyear6m

. save inductions_short6mt, replace
file inductions_short6mt.dta saved

. 
. summ

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        bplg |      1,200       29.32    15.63014          1         56
 birthyear6m |      1,200     19476.5    34.53854      19421      19532
staterisk6mt |        850    .0700239    .0260557   .0225214    .150252
nationalri~t |      1,193    .0603209    .0295971   .0127043   .1087385
nationalri~_ |        850    .0747075    .0218929    .040992   .1098719

. 
. * Right now missing for 19502 onwards because don't have cohort size data for these years
. summ birthyear6m if staterisk6mt==.

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 birthyear6m |        350    19518.71    10.20863      19502      19532

. summ if nationalrisk6mt==.

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        bplg |          7          56           0         56         56
 birthyear6m |          7    19518.71    11.01082      19502      19532
staterisk6mt |          0
nationalri~t |          0
nationalri~_ |          0

. 
. ***************************************************************************************
. *** generate state-level induction risk using 6 month level variation               ***
. *** construct average risk as average risk of ind/cohort size for next four cohorts ***
. ***************************************************************************************
. 
. clear

. use state_inductions_aw

. 
. **** reshape annual inductions and enrollment data into 6 month level data for each state and year combo ***
. gen int id=_n

. 
. forvalues x = 55/66 {
  2.   gen ind19`x'1 = ind19`x'/2
  3.   gen ind19`x'2 = ind19`x'/2
  4.   drop ind19`x'
  5.   }

.   
. forvalues x = 61/72 {
  2.   gen enr19`x'1 = enr19`x'/2
  3.   gen enr19`x'2 = enr19`x'/2
  4.   drop enr19`x'
  5.   }  

.   
. gen byte ind19731=0

. gen byte ind19741=0

. gen byte ind19751=0

. gen byte ind19761=0

. gen byte ind19732=0

. gen byte ind19742=0

. gen byte ind19752=0

. 
. * Assign fake cohort sizes so denominator defined in 19731 onwards
. gen byte enr19731=1

. gen byte enr19741=1

. gen byte enr19751=1

. gen byte enr19761=1

. gen byte enr19732=1

. gen byte enr19742=1

. gen byte enr19752=1

. 
. reshape long ind enr, i(id state abbrev) j(birthyear)
(note: j = 19551 19552 19561 19562 19571 19572 19581 19582 19591 19592 19601 19602 19611 19612 19621 19622 19631 19632 19641 19642 19651 19652 19661 19662 19671 19672 19681 19682
>  19691 19692 19701 19702 19711 19712 19721 19722 19731 19732 19741 19742 19751 19752 19761)
(note: enr19551 not found)
(note: enr19552 not found)
(note: enr19561 not found)
(note: enr19562 not found)
(note: enr19571 not found)
(note: enr19572 not found)
(note: enr19581 not found)
(note: enr19582 not found)
(note: enr19591 not found)
(note: enr19592 not found)
(note: enr19601 not found)
(note: enr19602 not found)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                       50   ->    2150
Number of variables                  78   ->       7
j variable (43 values)                    ->   birthyear
xij variables:
         ind19551 ind19552 ... ind19761   ->   ind
         enr19551 enr19552 ... enr19761   ->   enr
-----------------------------------------------------------------------------

. 
. gen birthyear6m = birthyear

. gen birth6m = birthyear

. replace birthyear = int(birthyear/10)
(2,150 real changes made)

. summ birthyear

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   birthyear |      2,150    1965.256    6.211313       1955       1976

. replace birth6m = birth6m - (birthyear*10)
(2,150 real changes made)

. summ birthyear6m birthyear birth6m

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
 birthyear6m |      2,150    19654.05    62.09502      19551      19761
   birthyear |      2,150    1965.256    6.211313       1955       1976
     birth6m |      2,150    1.488372    .4999811          1          2

. replace birthyear=birthyear-19
(2,150 real changes made)

. replace birthyear6m =birthyear6m-190
(2,150 real changes made)

. summ birthyear birthyear6m

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   birthyear |      2,150    1946.256    6.211313       1936       1957
 birthyear6m |      2,150    19464.05    62.09502      19361      19571

. drop id

. 
. **** generate national-level inductions and enrollment from the state data ***
. bys birthyear6m: egen ind_tot6m=total(ind)

. bys birthyear6m: egen enr_tot6m=total(enr)

. 
. gen ind_tot6m_=ind_tot6m-ind

. gen enr_tot6m_=enr_tot6m-enr
(600 missing values generated)

. 
. **** create national-level risk from the state data ***
. sort statefip birthyear6m

. gen sr = ind / enr
(600 missing values generated)

. gen nr = ind_tot6m / enr_tot6m
(600 missing values generated)

. gen nr_ = ind_tot6m_ / enr_tot6m_
(600 missing values generated)

. 
. by statefip: gen staterisk6ma = (sr+sr[_n+1]+sr[_n+2]+sr[_n+3]+sr[_n+4]+sr[_n+5]+sr[_n+6]+sr[_n+7])/8
(950 missing values generated)

. gen nationalrisk6ma = (nr+nr[_n+1]+nr[_n+2]+nr[_n+3]+nr[_n+4]+nr[_n+5]+nr[_n+6]+nr[_n+7])/8
(950 missing values generated)

. gen nationalrisk6ma_ = (nr_+nr_[_n+1]+nr_[_n+2]+nr_[_n+3]+nr_[_n+4]+nr_[_n+5]+nr_[_n+6]+nr_[_n+7])/8
(950 missing values generated)

. 
. *drop if all_ind6m ==.
. 
. 
. ******** restrict to 1942-53 **********
. drop if birthyear<1942 | birthyear>1953
(950 observations deleted)

. 
. 
. **** generate short inductions data
. rename statefip bplg

. keep bplg birthyear6m staterisk6ma nationalrisk6ma nationalrisk6ma_ 

. drop if bplg==.
(0 observations deleted)

. sort bplg birthyear6m

. save inductions_short6ma, replace
file inductions_short6ma.dta saved

. 
. summ

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        bplg |      1,200       29.32    15.63014          1         56
 birthyear6m |      1,200     19476.5    34.53854      19421      19532
staterisk6ma |      1,200    .0536334    .0341531   .0011085   .1502225
nationalri~a |      1,200    .0569497    .0335432   .0027506   .1089733
nationalri~_ |      1,200     .056949    .0335441   .0027006   .1101135

. 
. log close
      name:  <unnamed>
       log:  H:\Other\Paper Codes for Uploading\education-migration-IV\Induction_Risk_Data\inductionrisk_setup3.log
  log type:  text
 closed on:  18 Feb 2020, 09:39:02
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
